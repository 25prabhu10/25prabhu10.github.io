import{f as e,h as t,j as n,t as r}from"./chunks/plugin-vue_export-helper.CMCX8Lry.js";const i=JSON.parse(`{"title":"CQRS","description":"Command and Query Responsibility Segregation (CQRS)","frontmatter":{"title":"CQRS","description":"Command and Query Responsibility Segregation (CQRS)"},"headers":[],"relativePath":"Concepts/Designs/System_Designs/CQRS.md","filePath":"Concepts/Designs/System_Designs/CQRS.md","lastUpdated":1767053997000}`);var a={name:`Concepts/Designs/System_Designs/CQRS.md`};function o(r,i,a,o,s,c){return n(),e(`div`,null,[...i[0]||=[t(`<h1 id="cqrs" tabindex="-1">CQRS <a class="header-anchor" href="#cqrs" aria-label="Permalink to “CQRS”">​</a></h1><p><strong>Command and Query Responsibility Segregation</strong> (CQRS): a architectural style that separates read and write operations for a data store. Implementing CQRS in your application can maximize its performance, scalability, and security</p><ul><li>Commands: operations that change state (create, update, delete)</li><li>Queries: operations that return data without changing state (read)</li></ul><p>CQRS is based on the principle of Command Query Separation (CQS), which states that a method should either be a command that performs an action or a query that returns data, but not both. By separating commands and queries, CQRS allows for more flexible and scalable architectures</p><p>CQRS can be implemented in various ways, from having single database with separate read and write services which have synchronized views of the data, to using different databases for read and write operations which are eventually consistent (data may not be immediately consistent across read and write models)</p><p>The flexibility created by migrating to CQRS allows a system to better evolve over time and prevents update commands from causing merge conflicts at the domain level</p><ul><li><code>MediatR</code> package</li><li>Create a folder called <code>Queries</code></li><li>There add a class that gets item: Use <code>records</code></li></ul><div class="language-cs"><button title="Copy Code" class="copy"></button><span class="lang">cs</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">public</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> static</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> class</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> GetTodoById</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // Query / Command</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // All the data we need to execute</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  public</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> record</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">int</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Id</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">):</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> IRequest</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &gt;</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> ;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // Handler</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // All the business logic to execute. Returns a response</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  public</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> class</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Handler</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> IRequestHandler</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Query</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &gt;</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">    private</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> readonly</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Repository</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> _repository</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">    public</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Handler</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">Repository</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> repository</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">      _repository</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> repository</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">;</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">    public</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> async</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Task</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> &gt;</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Handle</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;">Query</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> request</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> CancellationToken</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> cancellationToken</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">      // All the business logic</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">      var</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> todo</span><span style="--shiki-dark:#666666;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> _repository</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">Todos</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">FirstOrDefault</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">x</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> x</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">Id</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> ==</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> request</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;">Id</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // Response</span></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;">  // The data we want to return</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;">  public</span><span style="--shiki-dark:#CB7676;--shiki-light:#D73A49;"> record</span><span style="--shiki-dark:#5DA994;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">int</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Id</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> string</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Name</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;"> bool</span><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;"> Completed</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">);</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">}</span></span></code></pre></div><p>References:</p><ul><li><a href="https://web.archive.org/web/20190211113420/http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/" target="_blank" rel="noreferrer">CQRS, Task Based UIs, Event Sourcing agh!</a></li><li><a href="https://web.archive.org/web/20160729165044/https://goodenoughsoftware.net/2012/03/02/cqrs/" target="_blank" rel="noreferrer">Greg Young&#39;s Blog</a>: CQRS <ul><li><p>CQRS is not a silver bullet</p></li><li><p>CQRS is not a top level architecture</p></li><li><p>CQRS is not new</p></li><li><p>CQRS is not shiny</p></li><li><p>CQRS will not make your jump shot any better</p></li><li><p>CQRS is not intrinsically linked to DDD</p></li><li><p>CQRS is not Event Sourcing</p></li><li><p>CQRS does not require a message bus</p></li><li><p>CQRS is not a guiding principle / CQS is</p></li><li><p>CQRS is not a good wife</p></li><li><p>CQRS is learnable in 5 minutes</p></li><li><p>CQRS is a small tactical pattern</p></li><li><p>CQRS can open many doors</p></li><li><p>And yes you can support <a href="https://datatracker.ietf.org/doc/html/rfc2549" target="_blank" rel="noreferrer">RFC 2549</a> using CQRS</p></li></ul></li></ul><p>Checkout this <a href="https://www.youtube.com/channel/UC3RKA4vunFAfrfxiJhPEplw/videos" target="_blank" rel="noreferrer">YouTube channel</a></p><h2 id="mediator" tabindex="-1">Mediator <a class="header-anchor" href="#mediator" aria-label="Permalink to “Mediator”">​</a></h2><p>The Mediator design pattern defines an object that encapsulates how a set of objects interact. Mediator promotes loose coupling by keeping objects from referring to each other explicitly, and it lets you vary their interaction independently</p><h2 id="repository-pattern-generic-repository-pattern-and-unit-of-work-pattern" tabindex="-1">Repository pattern, Generic Repository Pattern, and Unit of work pattern <a class="header-anchor" href="#repository-pattern-generic-repository-pattern-and-unit-of-work-pattern" aria-label="Permalink to “Repository pattern, Generic Repository Pattern, and Unit of work pattern”">​</a></h2><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to “References”">​</a></h2><ul><li><a href="https://www.youtube.com/results?search_query=dotnet+microservices" target="_blank" rel="noreferrer">A</a></li><li><a href="https://www.youtube.com/watch?v=WRg13Ze_UpY" target="_blank" rel="noreferrer">A</a></li><li><a href="https://www.youtube.com/results?search_query=+Udi+Dahan" target="_blank" rel="noreferrer">A</a></li><li><a href="https://particular.net/videos/microservices-and-rules-engines-a-blast-from-the-past" target="_blank" rel="noreferrer">A</a></li><li><a href="https://particular.net/videos/designing-a-ui-for-microservices" target="_blank" rel="noreferrer">A</a></li><li><a href="https://www.youtube.com/results?search_query=api+gateway" target="_blank" rel="noreferrer">A</a></li><li><a href="https://particular.net/blog/transactional-session" target="_blank" rel="noreferrer">A</a></li><li><a href="https://learn.particular.net/courses/cqrs?utm_source=presentation&amp;utm_campaign=ndc-oslo-2023" target="_blank" rel="noreferrer">A</a></li><li><a href="https://github.com/Particular/Workshop/blob/master/exercises/01-composite-ui/README.md" target="_blank" rel="noreferrer">A</a></li></ul>`,16)]])}var s=r(a,[[`render`,o]]);export{i as __pageData,s as default};