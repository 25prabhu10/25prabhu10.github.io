import{f as e,h as t,j as n,t as r}from"./chunks/plugin-vue_export-helper.Dz-VHcSB.js";const i=JSON.parse(`{"title":"Docker","description":"Docker is a set of platform as a service (PaaS) products","frontmatter":{"title":"Docker","description":"Docker is a set of platform as a service (PaaS) products"},"headers":[],"relativePath":"Concepts/CI-CD/Docker.md","filePath":"Concepts/CI-CD/Docker.md","lastUpdated":1766945700000}`);var a={name:`Concepts/CI-CD/Docker.md`};function o(r,i,a,o,s,c){return n(),e(`div`,null,[...i[0]||=[t(`<h1 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to “Docker”">​</a></h1><p>Docker is a set of platform as a service (PaaS) products that use OS-level virtualisation to deliver software in packages called <a href="#container">containers</a></p><ul><li>The software that hosts the containers is called <strong>Docker Engine</strong></li></ul><p><em>Example:</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># pull a docker image</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> pull</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> alpine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># run a new container from the image</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> run</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -t</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -d</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --name</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [customName] alpine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># check currently running Docker containers</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># connect to a container</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> exec</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -it</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [customName] sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># stop a container</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> stop</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [customName]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># check container stats</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> stats</span></span></code></pre></div><h2 id="container" tabindex="-1">Container <a class="header-anchor" href="#container" aria-label="Permalink to “Container”">​</a></h2><p>A way to <strong>package application</strong> with <strong>all</strong> the <strong>necessary dependencies</strong> and <strong>configuration</strong></p><ul><li>Portable artifact, easily shared and moved around</li></ul><p>Need of containers:</p><ul><li>Compatibility / Dependency</li><li>Long setup time</li><li>Different Dev/Test/Prod environments</li></ul><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to “Installation”">​</a></h2><p>We will use the Docker Engine (core of Docker) for running containers by following instructions in <a href="https://github.com/docker/docker-install/" target="_blank" rel="noreferrer">docker install repo</a> or <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noreferrer">install docker engine</a></p><ul><li>Run docker as non root user:</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sudo</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> groupadd</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> docker</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">sudo</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> usermod</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -aG</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> docker</span><span style="--shiki-dark:#BD976A;--shiki-light:#24292E;"> $USER</span></span></code></pre></div><p>If you want docker desktop features like GUI, you can install <a href="https://docs.docker.com/get-started/get-docker/" target="_blank" rel="noreferrer">Docker Desktop</a></p><h2 id="docker-cli" tabindex="-1">Docker CLI <a class="header-anchor" href="#docker-cli" aria-label="Permalink to “Docker CLI”">​</a></h2><p><em>Example:</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> build</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> build</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -t</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [image-name]:</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">version</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">]</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> image</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> image</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> rm</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [image-id]</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> rmi</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -f</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [image-id]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> run</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -p</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> 8080:3000</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -d</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --name</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [container-name] </span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">image-name</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> run</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -it</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [container-name]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># enter the container</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> exec</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -it</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [container-name] bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># delete container</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> rm</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [container-name] -f</span></span></code></pre></div><ul><li>Run Containers:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker run IMAGE</code></td><td>Start a new container</td></tr><tr><td><code>docker run --name CONTAINER IMAGE</code></td><td>Start a new container and set a name</td></tr><tr><td><code>docker run -p HOSTPORT:CONTAINERPORT IMAGE</code></td><td>Start a new container with mapped ports</td></tr><tr><td><code>docker run -P IMAGE</code></td><td>Start a new container and map all ports</td></tr></tbody></table><ul><li>Container Management:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker create IMAGE</code></td><td>Create a new container</td></tr><tr><td><code>docker start CONTAINER</code></td><td>Start a container</td></tr><tr><td><code>docker stop CONTAINER</code></td><td>Graceful stop a container</td></tr><tr><td><code>docker kill CONTAINER</code></td><td>Kill (<code>SIGKILL</code>) a container</td></tr><tr><td><code>docker restart CONTAINER</code></td><td>Graceful stop and restart a container</td></tr><tr><td><code>docker pause CONTAINER</code></td><td>Suspend a container</td></tr><tr><td><code>docker unpause CONTAINER</code></td><td>Resume a container</td></tr><tr><td><code>docker rm CONTAINER</code></td><td>Destroy a container</td></tr></tbody></table><ul><li>Container Bulk Management:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker stop $(docker ps -q)</code></td><td>To stop all the running containers</td></tr><tr><td><code>docker stop $(docker ps -a -q)</code></td><td>To stop all the stopped and running containers</td></tr><tr><td><code>docker kill $(docker ps -q)</code></td><td>To kill all the running containers</td></tr><tr><td><code>docker kill $(docker ps -a -q)</code></td><td>To kill all the stopped and running containers</td></tr><tr><td><code>docker restart $(docker ps -q)</code></td><td>To restart all running containers</td></tr><tr><td><code>docker restart $(docker ps -a -q)</code></td><td>To restart all the stopped and running containers</td></tr><tr><td><code>docker rm $(docker ps -q)</code></td><td>To destroy all running containers</td></tr><tr><td><code>docker rm $(docker ps -a -q)</code></td><td>To destroy all the stopped and running containers</td></tr><tr><td><code>docker pause $(docker ps -q)</code></td><td>To pause all running containers</td></tr><tr><td><code>docker pause $(docker ps -a -q)</code></td><td>To pause all the stopped and running containers</td></tr><tr><td><code>docker start $(docker ps -q)</code></td><td>To start all running containers</td></tr><tr><td><code>docker start $(docker ps -a -q)</code></td><td>To start all the stopped and running containers</td></tr><tr><td><code>docker rm -vf $(docker ps -a -q)</code></td><td>To delete all containers including its volumes use</td></tr><tr><td><code>docker rmi -f $(docker images -a -q)</code></td><td>To delete all the images</td></tr><tr><td><code>docker system prune</code></td><td>To delete all dangling and unused images, containers, cache and volumes</td></tr><tr><td><code>docker system prune -a</code></td><td>To delete all used and unused images</td></tr><tr><td><code>docker system prune --volumes</code></td><td>To delete all docker volumes</td></tr></tbody></table><ul><li>Inspect Containers:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker ps</code></td><td>List running containers</td></tr><tr><td><code>docker ps -a</code></td><td>List all containers, including stopped</td></tr><tr><td><code>docker logs CONTAINER</code></td><td>Show a container output</td></tr><tr><td><code>docker logs -f CONTAINER</code></td><td>Follow a container output</td></tr><tr><td><code>docker top CONTAINER</code></td><td>List the processes running in a container</td></tr><tr><td><code>docker diff</code></td><td>Show the differences with the image (modified files)</td></tr><tr><td><code>docker inspect</code></td><td>Show information of a container (json formatted)</td></tr></tbody></table><ul><li>Run Commands:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker attach CONTAINER</code></td><td>Attach to a container</td></tr><tr><td><code>docker cp CONTAINER:PATH HOSTPATH</code></td><td>Copy files from the container</td></tr><tr><td><code>docker cp HOSTPATH CONTAINER:PATH</code></td><td>Copy files into the container</td></tr><tr><td><code>docker export CONTAINER</code></td><td>Export the content of the container (tar archive)</td></tr><tr><td><code>docker exec CONTAINER</code></td><td>Run a command inside a container</td></tr><tr><td><code>docker exec -it CONTAINER /bin/bash</code></td><td>Open an interactive shell inside a container (there is no bash in some images, use /bin/sh)</td></tr><tr><td><code>docker wait CONTAINER</code></td><td>Wait until the container terminates and return the exit code</td></tr></tbody></table><ul><li>Images:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker images</code></td><td>List all local images</td></tr><tr><td><code>docker history IMAGE</code></td><td>Show the image history</td></tr><tr><td><code>docker inspect IMAGE</code></td><td>Show information (json formatted)</td></tr><tr><td><code>docker tag IMAGE TAG</code></td><td>Tag an image</td></tr><tr><td><code>docker commit CONTAINER IMAGE</code></td><td>Create an image (from a container)</td></tr><tr><td><code>docker import URL</code></td><td>Create an image (from a tarball)</td></tr><tr><td><code>docker rmi IMAGE</code></td><td>Delete images</td></tr><tr><td><code>docker pull REPO:[TAG]</code></td><td>pull an image/repo from a registry</td></tr><tr><td><code>docker push REPO:[TAG]</code></td><td>push and image/repo to a registry</td></tr><tr><td><code>docker search TEXT</code></td><td>Search an image on the official registry</td></tr><tr><td><code>docker login</code></td><td>Login to a registry</td></tr><tr><td><code>docker logout</code></td><td>Logout from a registry</td></tr><tr><td><code>docker save REPO:[TAG]</code></td><td>Export an image/repo as a tarball</td></tr><tr><td><code>docker load</code></td><td>Load images from a tarball</td></tr></tbody></table><ul><li>Volumes:</li></ul><table tabindex="0"><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>docker volume ls</code></td><td>List all volumes</td></tr><tr><td><code>docker volume create VOLUME</code></td><td>Create a volume</td></tr><tr><td><code>docker volume inspect VOLUME</code></td><td>Show information (json formatted)</td></tr><tr><td><code>docker volume rm VOLUME</code></td><td>Destroy a volume</td></tr><tr><td><code>docker volume ls --filter=&quot;dangling=true&quot;</code></td><td>List all dangling volumes (not referenced by any container)</td></tr><tr><td><code>docker volume prune</code></td><td>Delete all volumes (not referenced by any container)</td></tr></tbody></table><h2 id="dockerfile" tabindex="-1"><code>Dockerfile</code> <a class="header-anchor" href="#dockerfile" aria-label="Permalink to “Dockerfile”">​</a></h2><p>Each step is considered as a layer of an image</p><ul><li>Docker caches results layer by layer</li></ul><p><code>Dockerfile</code> statements:</p><table tabindex="0"><thead><tr><th>Command</th><th>Purpose</th></tr></thead><tbody><tr><td><code>FROM</code></td><td>To specify the parent image</td></tr><tr><td><code>WORKDIR</code></td><td>To set the working directory for any commands that follow in the <code>Dockerfile</code></td></tr><tr><td><code>RUN</code></td><td>To install any applications and packages required for your container</td></tr><tr><td><code>COPY</code></td><td>To copy over files or directories from a specific location</td></tr><tr><td><code>ADD</code></td><td>As <code>COPY</code>, but also able to handle remote URLs and unpack compressed files</td></tr><tr><td><code>CNTRYPOINT</code></td><td>The command that will always be executed when the container starts. if not specified, the default is <code>/bin/sh -c</code></td></tr><tr><td><code>CMD</code></td><td>Arguments passed to the entrypoint. If <code>ENTRYPOINT</code> is not set (defaults to <code>/bin/sh -c</code>) the <code>CMD</code> will be the commands the container executes</td></tr><tr><td><code>EXPOSE</code></td><td>To define which port through which to access your container application</td></tr><tr><td><code>LABEL</code></td><td>To add metadata to the image</td></tr></tbody></table><p><em>Example:</em></p><ul><li><p>From scratch:</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">FROM</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> scratch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># copy the contents of the &quot;helloworld&quot; binary to the root directory of the image</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">COPY</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> helloworld /</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># run the &quot;helloworld&quot; binary when the container starts</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">CMD</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">&quot;/helloworld&quot;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">]</span></span></code></pre></div></li><li><p>Python app:</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># pull official base image</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">FROM</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> python:latest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># Set the working directory</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">WORKDIR</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># Install dependencies</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">COPY</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> ./requirements.txt /app</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">RUN</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> pip install --no-cache-dir --upgrade -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># Copy the scripts to the folder</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">COPY</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> . /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># Start the app</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#D73A49;">CMD</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">&quot;python main.py&quot;</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;">]</span></span></code></pre></div></li></ul><p><code>.dockerignore</code> file is used to prevent sensitive or unnecessary files and directories from making their way into your image builds</p><p>It should be in the root directory, known as the build <strong>context</strong></p><h2 id="docker-compose" tabindex="-1">Docker-Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to “Docker-Compose”">​</a></h2><p>Docker-compose is a tool that is used for multi-container applications in a single host</p><p><a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noreferrer">Getting started</a></p><p><em>Example:</em> <code>docker-compose.yaml</code> file</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">version</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">3.9</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">services</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  web</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    build</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#4C9A91;--shiki-light:#005CC5;"> .</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    ports</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">      -</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">8000:5000</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  redis</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    image</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">redis:alpine</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span></span></code></pre></div><p>Networking:</p><p>By default Docker-Compose will create a new network for the given compose file. You can change the behaviour by defining custom networks in your compose file</p><ul><li>Create and assign custom network:</li></ul><p><em>Example:</em> <code>docker-compose.yml</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">networks</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  custom-network</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">services</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  app</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    networks</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">      -</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> custom-network</span></span></code></pre></div><ul><li>Use existing networks:</li></ul><p>If you want to use an existing Docker network for your compose files, you can add the <code>external: true</code> parameter in your compose file</p><p><em>Example:</em> <code>docker-compose.yml</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">networks</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  existing-network</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    external</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#4D9375;--shiki-light:#005CC5;"> true</span></span></code></pre></div><p>Volumes:</p><p>Volumes allow Docker containers to use persistent storage. In a compose file, you can create and map volumes like this:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">volumes</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  my-volume</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">services</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">  app</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#B8A965;--shiki-light:#22863A;">    volumes</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#24292E;">      -</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> my-volume:/path-in-container</span></span></code></pre></div><p>These volumes are stored in <code>/var/lib/docker/volumes</code></p><h3 id="docker-compose-commands" tabindex="-1">Docker-Compose Commands <a class="header-anchor" href="#docker-compose-commands" aria-label="Permalink to “Docker-Compose Commands”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># create and start containers</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># start services with detached mode</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -d</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># start specific service</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> up</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#24292E;"> [service-name]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># list images</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> images</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># list containers</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># start service</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> start</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># stop services</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> stop</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># display running containers</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> top</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># kill services</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> kill</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># remove stopped containers</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> rm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#758575DD;--shiki-light:#6A737D;"># stop all containers and remove images, volumes</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker-compose</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> down</span></span></code></pre></div><h2 id="networking" tabindex="-1">Networking <a class="header-anchor" href="#networking" aria-label="Permalink to “Networking”">​</a></h2><p>Troubleshooting: <code>docker run --name netshoot --rm -it nicolaka/netshoot /bin/bash</code></p><h2 id="backup-and-restore-containers" tabindex="-1">Backup and Restore Containers <a class="header-anchor" href="#backup-and-restore-containers" aria-label="Permalink to “Backup and Restore Containers”">​</a></h2><p>Backup docker data from inside container volumes and package it in a tarball archive</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> run</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --rm</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --volumes-from</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> CONTAINER</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -v</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> $(</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;">pwd</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">:/backup</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> busybox</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> tar</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> cvfz</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> /backup/backup.tar</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> CONTAINERPATH</span></span></code></pre></div><p>An automated backup can be done also by this <a href="https://github.com/thedatabaseme/docker_backup" target="_blank" rel="noreferrer">Ansible playbook</a></p><p>The output is also a (compressed) tar. The playbook can also manage the backup retention. So older backups will get deleted automatically</p><p>To also create and backup the container configuration itself, you can use <code>docker-replay</code>for that. If you lose the entire container, you can recreate it with the export from <code>docker-replay</code></p><ul><li><a href="https://thedatabaseme.de/2022/03/18/shorty-generate-docker-run-commands-using-docker-replay/" target="_blank" rel="noreferrer">How to use <code>docker-replay</code></a></li></ul><h3 id="restore-container-from-backup" tabindex="-1">Restore container from backup <a class="header-anchor" href="#restore-container-from-backup" aria-label="Permalink to “Restore container from backup”">​</a></h3><p>Restore the volume with a tarball archive:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-dark github-light" style="--shiki-dark:#dbd7caee;--shiki-light:#24292e;--shiki-dark-bg:#121212;--shiki-light-bg:#fff;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#6F42C1;">docker</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> run</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --rm</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> --volumes-from</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> CONTAINER</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -v</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;"> $(</span><span style="--shiki-dark:#B8A965;--shiki-light:#005CC5;">pwd</span><span style="--shiki-dark:#666666;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">:/backup</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> busybox</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;"> sh</span><span style="--shiki-dark:#C99076;--shiki-light:#005CC5;"> -c</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;"> &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#032F62;">cd CONTAINERPATH &amp;&amp; tar xvf /backup/backup.tar --strip 1</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#032F62;">&quot;</span></span></code></pre></div><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to “Reference”">​</a></h2><ul><li><a href="https://www.docker.com/" target="_blank" rel="noreferrer">Docker Homepage</a></li><li><a href="https://docs.docker.com/" target="_blank" rel="noreferrer">Docker Documentation</a></li><li>&quot;Learning Docker&quot; by Arthur Ulfeldt</li><li>Docker for .NET Developers with Visual Studio by Lee Brandt</li></ul>`,75)]])}var s=r(a,[[`render`,o]]);export{i as __pageData,s as default};